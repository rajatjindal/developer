name: Deploy Preview
on:
  pull_request:
    branches: [main]
    types: [opened, synchronize, reopened]
  issue_comment:                                     
    types: [created, edited]

jobs:
  deploy-preview:
    if: ${{ github.repository_owner == 'fermyon' }} && (github.event_name != 'issue_comment || (github.event.issue.pull_request && contains(github.event.comment.body, '/re-deploy')))
    runs-on: "ubuntu-latest"
    steps:
      - uses: actions/checkout@v3

      - name: Deploy PR preview to Fermyon Cloud
        uses: rajatjindal/fermyon-cloud/pr-preview@main
        with:
          fermyon_token: ${{ secrets.FERMYON_CLOUD_TOKEN }}
          github_token: ${{ secrets.GITHUB_TOKEN }}